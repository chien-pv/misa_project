$ ->
  total_volume = 0
  total_weight = 0
  thetich_container = 65
  khoiluong_container = 25000

  $(".map_thetich").text("Thể tích đạt yêu cầu")
  $(".map_khoiluong").text("Khối lượng đạt yêu cầu")

  $('.quantity').click ->
    quantity = $(this).val()
    row = $(this).closest('tr')
    volume = row.next().find(".volume")
    volume_detail  = row.next().find(".volume_detail")

    so_luong  = row.next().find(".so_luong").val()
    so_luong_nhan  = row.next().find(".so_luong_nhan").val()
    if quantity > so_luong - so_luong_nhan 
      row.find(".canh_bao").text("Số lượng nhập vào phải nhỏ hơn số lượng còn lại!")
    else
      row.find(".canh_bao").text("")

    val_volume = volume_detail.val()
    volume.text(val_volume*quantity)
    weight = row.next().find(".weight")
    weight_detail  = row.next().find(".weight_detail")
    val_weight = weight_detail.val()
    weight.text(val_weight*quantity)

    total_volume = 0
    total_weight = 0
    $('.volume').each (index, value) ->
      volume_dt = parseFloat($(this).text())
      total_volume += volume_dt
    $(".the_tich").text(total_volume)

    if thetich_container > total_volume
      $(".map_thetich").text("Thể tích đạt yêu cầu")
      $(".map_thetich").removeClass("alert-danger").addClass( "alert-success" )
      $(".map").removeClass("alert-danger").addClass( "alert-success" )
    if thetich_container == total_volume
      $(".map_thetich").text("Thể tích đạt yêu cầu")
      $(".map_thetich").removeClass("alert-danger").addClass( "alert-success" )
      $(".map").removeClass("alert-danger").addClass( "alert-success" )
    if thetich_container < total_volume
      $(".map_thetich").text("Thể tích vượt quá mức cho phép")
      $(".map_thetich").removeClass("alert-success").addClass( "alert-danger" )
      $(".map").removeClass("alert-success").addClass( "alert-danger" )

    $('.weight').each (index, value) ->
      weight_dt = parseFloat($(this).text())
      total_weight += weight_dt
    $(".khoi_luong").text(total_weight)
    if khoiluong_container > total_weight
      $(".map").removeClass("alert-danger").addClass( "alert-success" )
      $(".map_khoiluong").removeClass("alert-danger").addClass( "alert-success" )
      $(".map_khoiluong").text("Khối lượng đạt yêu cầu")
    if khoiluong_container == total_weight
      $(".map").removeClass("alert-danger").addClass( "alert-success" )
      $(".map_khoiluong").removeClass("alert-danger").addClass( "alert-success" )
      $(".map_khoiluong").text("Khối lượng đạt yêu cầu")
    if khoiluong_container < total_weight
      $(".map_khoiluong").text("Khối lượng vượt quá mức cho phép")
      $(".map").removeClass("alert-success").addClass( "alert-danger" )
      $(".map_khoiluong").removeClass("alert-success").addClass( "alert-danger" )

  $('.quantity').keyup ->
    quantity = $(this).val()
    row = $(this).closest('tr')
    volume = row.next().find(".volume")
    volume_detail  = row.next().find(".volume_detail")

    so_luong  = row.next().find(".so_luong").val()
    so_luong_nhan  = row.next().find(".so_luong_nhan").val()
    if quantity > so_luong - so_luong_nhan 
      row.find(".canh_bao").text("Số lượng nhập vào phải nhỏ hơn số lượng còn lại!")
    else
      row.find(".canh_bao").text("")

    val_volume = volume_detail.val()
    volume.text(val_volume*quantity)
    weight = row.next().find(".weight")
    weight_detail  = row.next().find(".weight_detail")
    val_weight = weight_detail.val()
    weight.text(val_weight*quantity)

    total_volume = 0
    total_weight = 0
    $('.volume').each (index, value) ->
      volume_dt = parseFloat($(this).text())
      total_volume += volume_dt
    $(".the_tich").text(total_volume)

    if thetich_container > total_volume
      $(".map_thetich").text("Thể tích đạt yêu cầu")
      $(".map_thetich").removeClass("alert-danger").addClass( "alert-success" )
      $(".map").removeClass("alert-danger").addClass( "alert-success" )
    if thetich_container == total_volume
      $(".map_thetich").text("Thể tích đạt yêu cầu")
      $(".map_thetich").removeClass("alert-danger").addClass( "alert-success" )
      $(".map").removeClass("alert-danger").addClass( "alert-success" )
    if thetich_container < total_volume
      $(".map_thetich").text("Thể tích vượt quá mức cho phép")
      $(".map_thetich").removeClass("alert-success").addClass( "alert-danger" )
      $(".map").removeClass("alert-success").addClass( "alert-danger" )

    $('.weight').each (index, value) ->
      weight_dt = parseFloat($(this).text())
      total_weight += weight_dt
    $(".khoi_luong").text(total_weight)
    if khoiluong_container > total_weight
      $(".map").removeClass("alert-danger").addClass( "alert-success" )
      $(".map_khoiluong").removeClass("alert-danger").addClass( "alert-success" )
      $(".map_khoiluong").text("Khối lượng đạt yêu cầu")
    if khoiluong_container == total_weight
      $(".map").removeClass("alert-danger").addClass( "alert-success" )
      $(".map_khoiluong").removeClass("alert-danger").addClass( "alert-success" )
      $(".map_khoiluong").text("Khối lượng đạt yêu cầu")
    if khoiluong_container < total_weight
      $(".map_khoiluong").text("Khối lượng vượt quá mức cho phép")
      $(".map").removeClass("alert-success").addClass( "alert-danger" )
      $(".map_khoiluong").removeClass("alert-success").addClass( "alert-danger" )